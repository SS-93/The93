# App Flow Document

## Onboarding and Sign-In/Sign-Up
When a new user first visits the landing page, they see a brief introduction to the platform’s features and a prompt to sign up or log in. To register, the user enters their name, email address, and a password, then confirms their email via a verification link. After verification, they choose their role from Artist, Host, Buyer, Brand, or Admin. Once signed up, the user can access a welcome screen that guides Artists and Hosts into the Stripe Connect Express onboarding flow. This flow opens an embedded Stripe window where they securely connect or create a Stripe account. The application stores the resulting Stripe account ID in Supabase and applies role-based row-level security policies so each user only sees what they are allowed to see. Returning users can sign in with their email and password, while a forgotten password link leads them through email-based recovery. Signing out is as simple as clicking the profile icon and selecting Log Out, which clears the session and returns the user to the landing page.

## Main Dashboard or Home Page
After logging in, each user lands on a dashboard tailored to their role. The layout features a fixed sidebar on the left for main navigation, a top header showing the user’s name and notifications, and a central content area. Artists and Hosts see their current balance, recent transactions, payout requests, tax reminders, and any open disputes. Buyers land on an event browser page with featured upcoming shows, past purchases, and tips history. Brands arrive at a deals page where they can view invitations to events, active offers, and contact consents. Admins enter a private operations dashboard showing system health metrics, queue depths, reserve levels, and key alerts. From the sidebar, everyone can navigate to pages such as Profile, Transactions, Payouts, Reporting, Settings, or Admin Tools.

## Detailed Feature Flows and Page Transitions
When an Artist or Host finishes Stripe Connect onboarding, they are redirected back to the dashboard where their Stripe account status appears as Connected. If they ever need to update bank details or reconnect, a Connect button in Account Settings re-launches the same Stripe flow.

For Buyers, browsing events begins on the Events page. Clicking an event card loads the Event Details page with ticket options, prices, and host information. Selecting a ticket triggers a call to the backend API, which creates a Stripe Checkout session and returns a redirect URL. The buyer completes payment in Stripe’s secure overlay and is then sent back to a Payment Confirmation page on the app. Behind the scenes, Stripe sends a webhook to the server, which verifies the signature, acquires an advisory lock to prevent duplicate processing, and then writes two entries into the double-entry ledger. The user is shown a “Purchase Successful” banner and the Tickets page now lists the new entry.

Once the ledger records the buyer’s debit and the platform’s reserve credit, the split engine inspects user-defined rules stored in the Splits page. These rules can be managed in a simple UI by Hosts who set percentages for artists, DJs, or brands. The engine calculates each share, writes additional ledger entries, and schedules transfers to payee Stripe accounts. Any transfer held for risk review is marked on the Transfers page with a Hold badge and emits a high-severity alert to the dedicated operations Slack channel. Users and Admins see hold details in real time.

A nightly scheduler reviews all approved transfers and executes payouts via Stripe’s Payout API. Each successful payout updates the ledger with a credit out of the platform reserve and a debit to the payee’s Stripe balance. Recipients receive an email confirmation, and if instant payouts are enabled, risk scoring runs immediately and may bypass the nightly batch. Any failure triggers exponential backoff retries and, if persistent, creates a support ticket visible in the Admin Tickets page.

When a Buyer requests a refund from the Order History page, the system creates reversal ledger entries that mirror the original transaction. If the refunded funds have already been paid out, the system flags a negative balance on the affected account and notifies Admins for manual resolution. Stripe dispute webhooks work similarly: they generate reversal entries, adjust reserves, and log an audit record. Once a dispute is closed or a chargeback is settled, any remaining personal data tied to the transaction is purged according to GDPR settings.

Under Contracts in the sidebar, Admins and developers can manage smart contract hooks. They upload or edit contract logic through a simple form, trigger a test simulation in the staging environment, and view execution history. In the future, this page will allow deployment to an Ethereum testnet.

The Analytics page connects to the Coliseum module and shows real-time revenue charts, leaderboards, and custom dimensions. Artists and Hosts review their performance metrics here. Event module Passport data also appears as a timeline of significant actions like onboarding, payouts, or refunds.

## Settings and Account Management
The Profile page lets users update personal details such as display name, email, profile picture, and notification preferences for email or Slack alerts. Under Account Settings, Artists and Hosts can re-launch Stripe Connect to change bank details or disconnect. Buyers and Brands manage their payment methods and address data here. The Notifications tab allows toggling of failure alerts, daily summaries, and critical updates. If a user has an active subscription, they can view or cancel it on the Subscriptions tab. For Admins, a Billing Settings page displays platform transaction fees and reserve requirements. Every settings update automatically returns the user to the dashboard or the last visited page, ensuring a seamless flow.

## Error States and Alternate Paths
Form validation errors—such as missing fields or invalid email formats—display inline messages in red under the relevant input field. Network timeouts or server errors show a full-width notification bar at the top, prompting users to retry. If a Stripe action fails, the user sees a clear message describing the problem, such as declined card or authentication required, and can reinitiate the flow. During webhook processing, if an advisory lock is unavailable, the system retries after a brief pause without user impact. In cases of severe outage, a maintenance page appears with an estimated recovery time. Users can always contact support via the Help link in the footer, and Admins see a live system status indicator in their dashboard.

## Conclusion and Overall App Journey
From landing on the homepage to signing up with email and connecting a Stripe account, every user moves through clear, guided steps. Artists and Hosts onboard and manage payout rules; Buyers explore events and make payments that flow through a secure webhook-to-ledger pipeline; Brands join events and execute promotional offers; and Admins oversee every step with monitoring, overrides, and detailed reports. Throughout daily usage, users interact with a unified interface that guides them through payments, analytics, and account management, while the system ensures security, accuracy, and compliance at every turn.